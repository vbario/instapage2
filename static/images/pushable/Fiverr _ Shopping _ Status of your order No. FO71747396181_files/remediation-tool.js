var sn=Object.defineProperty;var vt=Object.getOwnPropertySymbols;var an=Object.prototype.hasOwnProperty,cn=Object.prototype.propertyIsEnumerable;var Nt=(m,g,l)=>g in m?sn(m,g,{enumerable:!0,configurable:!0,writable:!0,value:l}):m[g]=l,wt=(m,g)=>{for(var l in g||(g={}))an.call(g,l)&&Nt(m,l,g[l]);if(vt)for(var l of vt(g))cn.call(g,l)&&Nt(m,l,g[l]);return m};var T=(m,g,l)=>new Promise((S,b)=>{var O=A=>{try{R(l.next(A))}catch(v){b(v)}},M=A=>{try{R(l.throw(A))}catch(v){b(v)}},R=A=>A.done?S(A.value):Promise.resolve(A.value).then(O,M);R((l=l.apply(m,g)).next())});(function(){"use strict";const m=()=>{const t=a=>a.length>1?a.slice(0,-1):a,{hostname:e,pathname:n}=window.location,r=e.replace("www.","").split("."),o=t(r).join("-"),s=n.split("/").filter(a=>a).join(" ").replace(/^\d+|\s\d+/g,"").trim();return(s+(s?" - ":" ")+o).trim()},g="https://cdn.userway.org/";var l=(t=>(t.Remediation="remediation",t.AriaEditor="aria-editor",t))(l||{}),S=(t=>(t.KeyboardNavEnabled="app-key-nav-enabled",t))(S||{});const b=({ruleId:t,isTargetElement:e,rule:n,postMessageApi:r})=>{const o=i=>!i.hasAttribute(`uw-ignore-${t}`);return r&&window.addEventListener("message",i=>{const{data:s}=i,{isUserWay:a,action:c,type:d}=s;!a||c!==l.Remediation&&c!==l.AriaEditor||r[d]&&r[d](s.data)}),{run:i=>{if(!e){n({context:{elements:i}});return}const s=i.filter(a=>o(a)&&e(a));s.length&&n({context:{elements:s}})},stop:()=>{},rerun:()=>{},ruleId:t}},O="data-uw-rm-title",M={UNKNOWN:"un",GENERIC:"gn"},R=(t,e)=>{t.setAttribute(O,e?M.GENERIC:M.UNKNOWN)},v=b({ruleId:"header-title",rule:()=>{var e;const t=document.getElementsByTagName("title")[0];try{const n=m();if(t)!((e=t.innerHTML)!=null&&e.trim())&&!t.hasAttribute(O)&&(t.innerHTML=n,R(t,n));else{const r=document.createElement("title");r.innerHTML=n,R(r,n),document.head.appendChild(r)}}catch(n){n instanceof Error&&console.error(n)}}}),Ct=b({ruleId:"aria-editor",rule:()=>{},postMessageApi:{"update-aria-hidden":()=>{},"update-tabindex":()=>{}}}),Ot={automaticcoupons:/automaticcoupons/,"shopping.yahoo":/shopping\.yahoo/,shopperapproved:/shopperapproved/,rakuten:/rakuten/,"translate.google":/translate\.google/,"maps.googleapis.com":/maps\.googleapis\.com/,"s.w.org":/s\.w\.org/,avatar:/avatar/,companylogos:/companylogos/,favicon:/favicon/,activecampaign:/lt\.php(.*)?l=open/,aweber:/openrate\.aweber\.com/,bananatag:/bl-1\.com/,boomerang:/mailstat\.us\/tr/,"campaign monitor":/cmail(\d+)\.com\/t\//,"cirrus insight":/tracking\.cirrusinsight\.com/,close:/close\.com\/email_opened/,"constant contact":/rs6\.net\/on\.jsp/,contactmonkey:/contactmonkey\.com\/api\/v1\/tracker/,convertkit:/convertkit-mail\.com\/o/,"critical impact":/portal\.criticalimpact\.com\/c2\//,emarsys:/emarsys\.com\/e2t\/o/,gem:/zen\.sr\/o/,getnotify:/email81\.com\/case/,getresponse:/getresponse\.com\/open\.html/,growthdot:/growthdot\.com\/api\/mail-tracking/,front:/app\.frontapp\.com\/(.*)?\/seen/,hubspot:/t\.(hubspotemail|hubspotfree|signaux|senal|sidekickopen|sigopn)/,icontact:/click\.icptrack\.com\/icp/,intercom:/(via\.intercom\.io\/o)|(intercom-mail\.com\/via\/o)/,litmus:/emltrk\.com/,mailchimp:/list-manage\.com\/track/,mailgun:/email\.(mailgun|mg)(.*)?\/o/,mailjet:/mjt\.lu\/oo/,mailspring:/getmailspring\.com\/open/,mailtrack:/(mailtrack\.io\/trace)|(mltrk\.io\/pixel)/,mandrill:/mandrillapp\.com\/track/,marketo:/resources\.marketo\.com\/trk/,mixmax:/(email|track)\.mixmax\.com/,mixpanel:/api\.mixpanel\.com\/track/,nethunt:/nethunt\.co(.*)?\/pixel\.gif/,newton:/tr\.cloudmagic\.com/,outreach:/api\/mailings\/opened/,phplist:/phplist\.com\/lists\/ut\.php/,polymail:/polymail\.io/,postmark:/pstmrk\.it\/open/,"return path":/returnpath\.net\/pixel\.gif/,sailthru:/sailthru\.com\/trk/,salesforce:/nova\.collect\.igodigital\.com/,sendgrid:/wf\/open\?upn/,sendy:/sendy\/t\//,streak:/mailfoogae\.appspot\.com/,superhuman:/r\.superhuman\.com/,thunderhead:/na5\.thunderhead\.com/,tinyletter:/tinyletterapp\.com.*open\.gif/,yamm:/yamm-track\.appspot/,yesware:/t\.yesware\.com/,"zendesk sell":/futuresimple\.com\/api\/v1\/sprite\.png/},K=new RegExp("^(data:)"),q=new RegExp(/^.+\.svg$/),Mt=50,j=10,Dt=5,J=10,xt=255;var f=(t=>(t.EXCLUDED_SRC="EXCLUDED_SRC",t.HIDDEN_FROM_SCREEN_READER="HIDDEN_FROM_SCREEN_READER",t.BASE64="BASE64",t.SVG="SVG",t.SMALL_SIZE="SMALL_SIZE",t.MICRO_SIZE="MICRO_SIZE",t.WRONG_SRC="WRONG_SRC",t.ASPECT_RATIO="ASPECT_RATIO",t))(f||{});const Q=["SVG","SMALL_SIZE","HIDDEN_FROM_SCREEN_READER"],D="data-uw-rm-alt-original",Y="REMEDIATION_IMAGE_MISSING_ALT",y="data-uw-rm-alt",Lt=1e3,Wt=2e3,tt=["jpg","jpeg","png","gif","bmp","tiff","tif","svg","webp","ico","apng","heif","heic","avif","eps","raw","cr2","nef","orf","sr2"],Ut=t=>{const e=t.tagName.toLowerCase()==="img",n=t.hasAttribute(y);if(!e||n)return!1;const r=t.getAttribute("src"),o=t.getAttribute("srcset");return!!(r!=null?r:o)||!!t.closest("picture")},p=({currentSrc:t,src:e})=>t||e,G=(t,e)=>{try{const{width:r,height:o}=window.getComputedStyle(t);return parseInt(r,10)>e&&parseInt(o,10)>e}catch(r){return!1}},_=(t,{decorative:e,approved:n,fixedByUserWay:r,loadingFromMS:o})=>{var i;return{src:p(t),alt:t.alt,originalAlt:(i=t.getAttribute(D))!=null?i:"",decorative:e,approved:n,fixedByUserWay:r,loadingFromMS:o}},P=t=>{t.setAttribute("role","presentation"),t.removeAttribute("aria-hidden"),t.setAttribute("alt","")},et=t=>{if(!t)return"";const{hostname:e}=new URL(t);return e.replace(/^https?:\/\//,"").replace(/^www\./,"").replace(/\.[a-zA-Z0-9]*$/,"")},kt=t=>{const e=[];return t.forEach(r=>{const o=p(r),i=et(o);if(i){let s=e.find(a=>a.name===i);s||(s={name:i,weight:0},e.push(s)),s.weight+=1}}),e.sort((r,o)=>r.weight<o.weight?1:-1)[0].name},jt=(t,e)=>{const n=p(t);return et(n)!==e&&!G(t,j)},Gt=t=>T(this,null,function*(){return yield(yield fetch(t)).json()}),Pt={AriaEditorValues:[],BrokenLink:[],Contrast:[],EmptyControls:[],ExternalLink:[],Forms:[],Headings:[],Language:[],MissingAlts:[],Pdfs:[],VagueLinks:[]},B=UserWayWidgetApp.ContextHolder.config.remediation,F=UserWayWidgetApp.ContextHolder.config.tunings,Bt=UserWayWidgetApp.ContextHolder.config.services,nt=UserWayWidgetApp.ContextHolder.config.imageAlt;function rt(t){wt({},t)}const ot=()=>T(this,null,function*(){const{consolidated:t}=B;if(t){const e=yield Gt(t);e.MissingAlts.reverse(),rt(e);return}rt(Pt)}),x=t=>{const n=new RegExp(`\\.(${tt.join("|")})$`,"i").test(t),r=t.length>xt,o=!t.trim(),i=/[0-9]{5,}/.test(t),a=new RegExp(/^[!@#$%^&*()_+{}[\]`:;<>,.?~\\|\-="'/]+$/,"u").test(t);return i||n||r||o||a},Ft=new RegExp("^(data:)"),$t=new RegExp("(.)(gif|jpe?g|tiff?|png|webp|bmp)","i"),L=t=>{if(Ft.test(t))return t;t&&(t=t.replace(/^(http|https)(:\/\/)/,"").replace(/^(www\.)/,""));const e=t.match($t);return e!=null&&e.index&&(e!=null&&e.length)?t.substring(0,e.index+e[0].length):t.split("?")[0]},Ht=t=>{try{const e=new URL(t);return e.search="",e.toString()}catch(e){return t}},Xt=(t,e)=>{const n=e.alt.trim(),r=p(e),o=t.find(w=>L(w.src)===L(r));if(!o||o.alt===null)return null;const{decorative:i,alt:s,approved:a,reverted:c}=o;if(c)return e.setAttribute(y,"true"),_(e,{approved:!0,decorative:!n,fixedByUserWay:!1});const E=!(B.strategy==="AUTO")&&!a;i&&!E&&P(e);const h=a||!n||x(n);return s&&!E&&h&&!i&&e.setAttribute("alt",s),e.setAttribute(y,"true"),_(e,{approved:a,decorative:i,fixedByUserWay:!0})},Zt=t=>{if(typeof t!="string")return!1;for(const e of Object.values(Ot)){const n=new RegExp(e,"i");if(t.match(n))return!0}return!1},zt=t=>t?t.match(K)?!1:!new RegExp(`^https?://.{1,256}\\.[a-z]{2,6}/.*\\.(${tt.join("|")})(\\?.*)?$`,"i").test(t):!0,Vt=t=>{try{const{width:n,height:r}=window.getComputedStyle(t),o=parseInt(n,10),i=parseInt(r,10),s=o<=j&&i>=o*J,a=i<=j&&o>=i*J;return!!(s||a)}catch(n){return!1}},$=t=>{const e=p(t),n=x(t.alt);return zt(e)?f.WRONG_SRC:Zt(e)?f.EXCLUDED_SRC:G(t,Dt)?Vt(t)?f.ASPECT_RATIO:K.test(e)?f.BASE64:t.getAttribute("aria-hidden")==="true"||t.getAttribute("role")==="presentation"||t.getAttribute("role")==="none"?f.HIDDEN_FROM_SCREEN_READER:q.test(e)&&n?f.SVG:!G(t,Mt)&&n?f.SMALL_SIZE:null:f.MICRO_SIZE},Kt=(t,e,n,r)=>{const o=UserWayWidgetApp.getLib("remediation_manager"),s=UserWayWidgetApp.getLib("remediation_helper_outcome").of(t,{items:e},null,n,r);o.HelperCallbackAggregator.onHelperRemediationCompleted(s)},it=t=>Kt(Y,t,t.filter(e=>e.fixedByUserWay).length,t.filter(e=>!e.approved).length),qt=t=>{t.hasAttribute(D)||t.setAttribute(D,t.alt)},st=(t,e=[])=>{var r;if(t.length===0)return;const n=[];for(const o of t){const i=o,s=x(i.alt),a=p(i);qt(i),q.test(a)&&i.setAttribute("role","img");const c=Xt(e,i);if(c){n.push(c);continue}const d=$(i);if(!s&&!d){i.setAttribute(y,"true"),n.push(_(i,{approved:!0,decorative:!1,fixedByUserWay:!1}));continue}if(d!==null||(r=B.alt)!=null&&r.quotaExceeded){P(i),i.setAttribute(y,"true"),d&&Q.includes(d)&&n.push(_(i,{approved:!1,decorative:!0,fixedByUserWay:!0}));continue}i.setAttribute(y,"true"),n.push(_(i,{approved:!1,decorative:!1,fixedByUserWay:!0,loadingFromMS:!0}))}it(n)},at=t=>{const e=t.replace(/^https?:\/\//,"");return document.querySelectorAll(`img[src*="${e}" i],img[srcset*="${e}" i]`)},Jt=({src:t})=>{const e=at(t);for(const n of e){const r=n.getAttribute(D);r!==null&&n.setAttribute("alt",r)}},Qt=({src:t,decorative:e,alt:n,role:r})=>{const o=at(t);if(o.length){for(const i of o)i.setAttribute("alt",n!=null?n:""),e?P(i):((i.getAttribute("role")==="presentation"||i.getAttribute("role")==="none")&&i.removeAttribute("role"),i.hasAttribute("aria-hidden")&&i.removeAttribute("aria-hidden")),["link","button","heading"].includes(r)&&i.setAttribute("aria-label",n);it([_(o[0],{approved:!0,decorative:e,fixedByUserWay:!1})])}},Yt=()=>{ot()};var te=typeof global=="object"&&global&&global.Object===Object&&global;const ee=te;var ne=typeof self=="object"&&self&&self.Object===Object&&self,re=ee||ne||Function("return this")();const ct=re;var oe=ct.Symbol;const W=oe;var lt=Object.prototype,ie=lt.hasOwnProperty,se=lt.toString,N=W?W.toStringTag:void 0;function ae(t){var e=ie.call(t,N),n=t[N];try{t[N]=void 0;var r=!0}catch(i){}var o=se.call(t);return r&&(e?t[N]=n:delete t[N]),o}var ce=Object.prototype,le=ce.toString;function ue(t){return le.call(t)}var de="[object Null]",ge="[object Undefined]",ut=W?W.toStringTag:void 0;function me(t){return t==null?t===void 0?ge:de:ut&&ut in Object(t)?ae(t):ue(t)}function pe(t){return t!=null&&typeof t=="object"}var fe="[object Symbol]";function Ee(t){return typeof t=="symbol"||pe(t)&&me(t)==fe}var he=/\s/;function Ae(t){for(var e=t.length;e--&&he.test(t.charAt(e)););return e}var Ie=/^\s+/;function be(t){return t&&t.slice(0,Ae(t)+1).replace(Ie,"")}function U(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var dt=0/0,Re=/^[-+]0x[0-9a-f]+$/i,ye=/^0b[01]+$/i,_e=/^0o[0-7]+$/i,Te=parseInt;function gt(t){if(typeof t=="number")return t;if(Ee(t))return dt;if(U(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=U(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=be(t);var n=ye.test(t);return n||_e.test(t)?Te(t.slice(2),n?2:8):Re.test(t)?dt:+t}var Se=function(){return ct.Date.now()};const H=Se;var ve="Expected a function",Ne=Math.max,we=Math.min;function X(t,e,n){var r,o,i,s,a,c,d=0,E=!1,h=!1,w=!0;if(typeof t!="function")throw new TypeError(ve);e=gt(e)||0,U(n)&&(E=!!n.leading,h="maxWait"in n,i=h?Ne(gt(n.maxWait)||0,e):i,w="trailing"in n?!!n.trailing:w);function z(u){var I=r,C=o;return r=o=void 0,d=u,s=t.apply(C,I),s}function en(u){return d=u,a=setTimeout(k,e),E?z(u):s}function nn(u){var I=u-c,C=u-d,St=e-I;return h?we(St,i-C):St}function _t(u){var I=u-c,C=u-d;return c===void 0||I>=e||I<0||h&&C>=i}function k(){var u=H();if(_t(u))return Tt(u);a=setTimeout(k,nn(u))}function Tt(u){return a=void 0,w&&r?z(u):(r=o=void 0,s)}function rn(){a!==void 0&&clearTimeout(a),d=0,r=c=o=a=void 0}function on(){return a===void 0?s:Tt(H())}function V(){var u=H(),I=_t(u);if(r=arguments,o=this,c=u,I){if(a===void 0)return en(c);if(h)return clearTimeout(a),a=setTimeout(k,e),z(c)}return a===void 0&&(a=setTimeout(k,e)),s}return V.cancel=rn,V.flush=on,V}var Ce="Expected a function";function Oe(t,e,n){var r=!0,o=!0;if(typeof t!="function")throw new TypeError(Ce);return U(n)&&(r="leading"in n?!!n.leading:r,o="trailing"in n?!!n.trailing:o),X(t,e,{leading:r,maxWait:e,trailing:o})}const Me=t=>T(this,null,function*(){const{account:e}=UserWayWidgetApp.ContextHolder.config,{siteId:n}=Bt,{resourceHash:r}=nt,o=encodeURIComponent(t);return(yield(yield fetch(`${g}api/img-dscr/v2/${e}/${n}/${r}/alts.json?dto=${o}`,{method:"GET",headers:{"Content-Type":"application/json"}})).json()).payload});var mt=(t=>(t.RO="RO",t))(mt||{});const De=(t,e)=>t.src.localeCompare(e.src),xe=t=>{const e=t,n=e.filter((r,o)=>o===e.findIndex(i=>p(r)===p(i))).map(r=>{const o=r,i=o.alt.trim(),s=i&&!x(i),a=p(o);return{src:Ht(a),alt:o.alt.trim(),dir:s||$(o)?mt.RO:void 0}});return n.sort(De),n},Le=(t,e)=>{const n=Math.ceil(t.length/e),r=[];for(let o=0;o<t.length;o+=n)r.push(t.slice(o,o+n));return r},We=t=>encodeURIComponent(t).length/1024,Ue=8,ke=10,pt=(t,e=1)=>{if(e>=ke)throw new Error("Max split level exceed");const n=Le(t,e),r=[];for(const o of n){const s=JSON.stringify({sorted:o});if(We(s)>Ue)return pt(t,e+1);r.push(s)}return r},Z=[],je=()=>{Z.length=0},Ge=t=>{const{state:e}=nt;if(e==="ALTS_OFF")return;const n=kt(t),r=[],o=[];for(const i of t){const s=i,a=jt(s,n),c=$(s);c&&!Q.includes(c)||a?o.push(s):r.push(s)}try{const i=xe(r),s=pt(i);for(const a of s)Me(a).then(({missingAlts:c})=>{const d=r.filter(E=>c.find(h=>L(h.src)===L(p(E))));st(d,c)})}catch(i){console.error(i)}st(o),je()},Pe=X(t=>Ge(t),Lt,{maxWait:Wt,leading:!0,trailing:!0}),Be=b({ruleId:Y,rule:({context:{elements:t}})=>{Z.push(...t),Pe(Z)},isTargetElement:Ut,postMessageApi:{"image-alt-update":Qt,"image-alt-revert":Jt,"image-alt-update-config":Yt}}),Fe=[v,Be,Ct],ft=["script","noscript","style","path","circle","rect","ellipse","line","polygon","polyline","g"],Et=["data-uw-ignore","data-uw-rm-ignore"],ht=()=>{const t=ft.join(","),e=Et.map(r=>`[${r}]`).join(","),n=`${t},${e}`;return document.body.querySelectorAll(`*:not(${n})`)},$e=300,He=500,Xe=2e3,Ze=2e3,ze=500;let At=!0;const Ve=t=>{setTimeout(()=>{At=!1},Ze);const e=Oe(o=>t(o),$e,{leading:!0,trailing:!0}),n=X(o=>t(o),He,{maxWait:Xe,leading:!0,trailing:!0});return{run:o=>At?e(o):n(o)}},It=(t,e)=>{const n=o=>{const{data:i}=o,{isUserWay:s,action:a,type:c}=i;!s||a!==l.Remediation||c!==t||e()};return window.addEventListener("message",n),()=>{window.removeEventListener("message",n)}},bt=(()=>{let t=!1,e=[];const n=s=>{t||(t=!0,Fe.forEach(a=>{a.run(s)}),t=!1,e=[])},{run:r}=Ve(n);return{run:r,init:()=>T(this,null,function*(){if(!F.tech_rem_on_tab){const a=ht();r([...a])}const s=It(S.KeyboardNavEnabled,()=>{const a=ht();r([...a]),s()})}),onDomUpdates:s=>{e.push(...s),r(e)}}})(),Rt=t=>!(t instanceof HTMLElement)||Et.some(e=>t.hasAttribute(e))||ft.includes(t.nodeName.toLowerCase()),Ke=(t,e)=>e==="childList"?[].filter.call(t.addedNodes,n=>!Rt(n)):e==="attributes"?Rt(t.target)?[]:[t.target]:[],qe=t=>{const e=[];for(const n of t)e.push(...Ke(n,n.type));return e},Je=["aria-label","alt"],Qe=document.body,Ye={attributes:!0,attributeFilter:Je,childList:!0,subtree:!0},yt=new MutationObserver(t=>{const e=qe(t);e.length&&bt.onDomUpdates(e)}),tn=(t=Qe,e=Ye)=>{F.tech_rem_on_tab||yt.observe(t,e);const n=It(S.KeyboardNavEnabled,()=>{yt.observe(t,e),n()})};(()=>T(this,null,function*(){var e;yield ot();const t=(e=F.tech_rem_in_throttle_ms)!=null?e:ze;setTimeout(()=>{bt.init(),tn()},t)}))()})();
//# sourceMappingURL=remediation-tool.js.map
